{% extends 'global/base.html' %}

{% block content %}

<style>
    .form-container {
        margin-top: 65px;
    }
</style>

<div class="form-container">
    <form method="post" class="form-1col" action="{% url 'logistica:consulta_id_form' %}">
        {% include 'global/partials/_form_1col.html' %}
    </form>
</div>

{% if tabela_dados %}
<div class="cards-container">
    {% for item in tabela_dados %}
    <div class="card">
        <div class="card-header">
            <span class="badge-num">{{ forloop.revcounter }}</span>
            <h3>{{ item.serge }}</h3>
            <button class="toggle-btn">+</button>
        </div>
        <div class="card-flyout">
            <p><strong>matnr:</strong> {{ item.matnr }}</p>
            <p><strong>gernr:</strong> {{ item.gernr }}</p>
            <p><strong>ztipo:</strong> {{ item.ztipo }}</p>
            <p><strong>zver_ap:</strong> {{ item.zver_ap }}</p>
            <p><strong>zsta_eq:</strong> {{ item.zsta_eq }}</p>
            <p><strong>id_lote:</strong> {{ item.id_lote }}</p>
        </div>
    </div>
    {% endfor %}
</div>>

<!-- <div class="buttons-container">
    <a href="{% url 'logistica:consulta_id_form' %}">
        <button class="btn-voltar" onclick="history.back()">Limpar</button>
    </a>
    {% include 'global/partials/_pagination.html' %}
    <div class="buttons_id">
        <a href="{% url 'logistica:pre_recebimento' 13 %}">
            <button class="btn-p-rec">Pré-recebimento</button>
        </a>
        <a href="{% url 'logistica:recebimento' 15 %}">
            <button class="btn-rec">Recebimento</button>
        </a>
    </div>
</div> -->
{% endif %}

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cards = Array.from(document.querySelectorAll(".card"));

        function closeAll(except = null) {
            cards.forEach(c => {
                if (c !== except) {
                    c.classList.remove("open");
                    const btn = c.querySelector(".toggle-btn");
                    if (btn) btn.textContent = "+";
                    if (btn) btn.setAttribute("aria-expanded", "false");
                }
            });
        }

        cards.forEach(card => {
            const btn = card.querySelector(".toggle-btn");
            if (!btn) return;

            btn.addEventListener("click", (e) => {
                e.stopPropagation();
                const isOpen = card.classList.contains("open");
                closeAll();
                if (!isOpen) {
                    card.classList.add("open");
                    btn.textContent = "−";
                    btn.setAttribute("aria-expanded", "true");

                    const fly = card.querySelector(".card-flyout");
                    if (fly) {
                        const rect = fly.getBoundingClientRect();
                        const overflowRight = rect.right - window.innerWidth + 8;
                        if (overflowRight > 0) {
                            fly.style.left = `${8 - overflowRight}px`;
                            fly.style.right = `8px`;
                        } else {
                            fly.style.left = "8px";
                            fly.style.right = "8px";
                        }
                    }
                }
            });
        });

        document.addEventListener("click", () => closeAll());
    });
</script>
{% endblock content %}