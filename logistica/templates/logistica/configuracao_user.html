{% extends 'global/base.html' %}

{% block content %}

<div class="profile-modal">
  <div class="profile-header">
    <h2>Meu Perfil</h2>
    <a class="btn-link" href="#" onclick="history.back();return false;">✕</a>
  </div>

  <div class="profile-tabs">
    <a class="profile-tab active" href="javascript:void(0)">Dados do Usuário</a>
    {# se quiser outras abas, adicione aqui #}
  </div>

  <div class="profile-body">
    <form method="post" enctype="multipart/form-data" action="{% url 'logistica:settings' %}">
      {% csrf_token %}

      <div class="profile-grid">
        <div class="avatar-col">
          <label for="id_avatar" class="avatar"
                 id="avatarPreview"
                 style="background-image:url('{{ request.user.profile_photo_url|default:"" }}');">
          </label>
          {# Se tiver um campo de upload no form, exiba-o. Se não tiver, remova este bloco. #}
          {% if form.avatar %}
            <label for="{{ form.avatar.id_for_label }}" class="avatar-btn">Alterar foto</label>
            {{ form.avatar }}
            <div class="form-hint">PNG/JPG até 2MB.</div>
          {% else %}
            <div class="form-hint">Foto do perfil (opcional)</div>
          {% endif %}
          <a href="{% url 'logistica:password_change' %}" class="btn btn-outline">Alterar senha</a>
        </div>

        <div class="fields">
            {% for field in form %}
            <label for={{ field.id_for_label }} class="avatar-btn">{{ field.label }}</label> 
            {{ field }}
            {% endfor %}
        </div>

      <div class="actions">
        <div></div>
        <button type="submit" class="btn btn-primary">Salvar</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.querySelector('input[type="file"][id^="id_avatar"]');
    const preview   = document.getElementById('avatarPreview');
    if (fileInput && preview) {
      fileInput.addEventListener('change', (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        const url = URL.createObjectURL(f);
        preview.style.backgroundImage = `url('${url}')`;
      });
    }
  });
</script>
{% endblock content %}
