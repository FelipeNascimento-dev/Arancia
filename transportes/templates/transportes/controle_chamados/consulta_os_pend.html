{% extends 'global/base.html' %}

{% block content %}

<style>
    .form-card-2col {
        height: auto;
        margin-top: 65px;
    }

    .cards-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 32px;
        padding: 20px 10px 40px;
    }

    .card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 26px rgba(0,0,0,.08);
        overflow: hidden;
        max-width: 410px;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        transition: transform .2s ease, box-shadow .2s ease;
    }

    .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 36px rgba(0,0,0,.12);
    }

    .card-header {
        background-color: #ccc;
        color: #fff;
        padding: 18px 22px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .os-code {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: .5px;
        text-decoration: none;
        color: #fff;
    }

    .tag {
        background: rgba(255,255,255,.2);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: .85rem;
        font-weight: 600;
    }

    .card-section {
        padding: 18px 22px;
        border-top: 1px solid #f0f0f0;
    }

    .card-section.grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 18px 24px;
    }

    .card-section.highlight {
        background: #fafafa;
        border-left: 5px solid #ff6f00;
    }

    .label {
        font-size: .75rem;
        text-transform: uppercase;
        font-weight: 600;
        color: #777;
        display: block;
        margin-bottom: 4px;
    }

    .value {
        font-size: .95rem;
        font-weight: 500;
        color: #222;
        line-height: 1.45;
    }

    @media (max-width: 768px) {
        .cards-container {
            grid-template-columns: 1fr;
        }

        .card-section.grid {
            grid-template-columns: 1fr;
        }
    }

    .pagination-container {
        margin: 30px 0 10px;
        text-align: center;
    }

    .btn-page {
        background: #ccc;
        color: #fff;
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
    }

    .btn-page:hover {
        background: #ccc;
    }

    .page-indicator {
        font-weight: 600;
        color: #444;
        padding: 10px 14px;
    }

    .extract-balanced {
        background: #0f9d58;
        color: #ffffff;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: 0.2s;
    }

    .extract-balanced:hover {
        background: #0c7c45;
    }
</style>

<div class="form-container">
    <div class="form-card-2col">
        <form method="POST">
            {% csrf_token %}
            {% include 'global/partials/_form_2col.html' %}
        </form>
        <form method="POST">
            {% csrf_token %}

            <input type="hidden" name="base" value="{{ form.base.value }}">
            <input type="hidden" name="tecnico" value="{{ form.tecnico.value }}">
            <input type="hidden" name="tag" value="{{ form.tag.value }}">
            <input type="hidden" name="data_inicial" value="{{ form.data_inicial.value }}">
            <input type="hidden" name="data_final" value="{{ form.data_final.value }}">

            <button type="submit" name="exportar" value="1" class="extract-balanced">
                <i class="fa-solid fa-download"></i> Exportar
            </button>
        </form>
    </div>
</div>

{% if itens %}
<div class="cards-container">
    {% for item in itens %}
    <div class="card" data-tag="{{ item.tag }}">
        <div class="card-header">
            <a class="os-code"
          href="{% url 'transportes:detalhe_os' item.os %}"
          target="_blank">{{ item.os }}</a>
            <span class="tag">{{ item.tag }}</span>
        </div>

        <div class="card-section grid">
            <div>
                <span class="label">Técnico</span>
                <span class="value">{{ item.nome_tecnico }}</span>
            </div>

            <div>
                <span class="label">Projeto</span>
                <span class="value">{{ item.projeto }}</span>
            </div>

            <div>
                <span class="label">Unidade</span>
                <span class="value">{{ item.unidade }}</span>
            </div>

            <div>
                <span class="label">Abertura</span>
                <span class="value">{{ item.dt_abertura_fmt }}</span>
            </div>
        </div>

        <div class="card-section">
            <span class="label">Endereço</span>
            <span class="value">
                {{ item.bairro }} – {{ item.cidade }}<br>
                CEP {{ item.cep }}
            </span>
        </div>

        <div class="card-section highlight">
            <span class="label">Conclusão Operador</span>
            <span class="value">{{ item.conclusao_operador|default:"-" }}</span>
        </div>

        <div class="card-section">
            <span class="label">Mensagem</span>
            <span class="value">{{ item.mensagem|default:"-" }}</span>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if itens %}
<div class="pagination-container">
    <form method="POST" style="display:flex;gap:12px;justify-content:center;">
        {% csrf_token %}

        <input type="hidden" name="base" value="{{ form.base.value }}">
        <input type="hidden" name="tecnico" value="{{ form.tecnico.value }}">
        <input type="hidden" name="tag" value="{{ form.tag.value }}">
        <input type="hidden" name="data_inicial" value="{{ form.data_inicial.value }}">
        <input type="hidden" name="data_final" value="{{ form.data_final.value }}">
        <input type="hidden" name="enviar_evento" value="1">

        {% if has_prev %}
        <button type="submit" name="page" value="{{ page|add:'-1' }}" class="btn-page">
            <i class="fa-solid fa-angles-left"></i>
        </button>
        {% endif %}

        <span class="page-indicator">
            Página {{ page }}
        </span>

        {% if has_next %}
        <button type="submit" name="page" value="{{ page|add:'1' }}" class="btn-page">
            <i class="fa-solid fa-angles-right"></i>
        </button>
        {% endif %}
    </form>
</div>
{% endif %}



{% endblock %}