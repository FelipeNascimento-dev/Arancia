

<div class="setcontainer">


<!-- TABELA DE TÉCNICOS -->
<div id="tabela-tecnicos" {% if filtro_ativo or ver_rota_uid %}style="display:none"{% endif %}>

  <h4>Resumo por Técnico</h4>
  <div class="table-responsive ">
    {% if tecnicos %}
    <table class="styled-table dark table-sd">
      <thead>
        <tr>
          <th>Ação</th><th>Nome</th><th>UID</th><th>Unidade</th>
          <th>Total OS</th><th>Concluído</th><th>No Tempo</th><th>No Limite</th>
          <th>Atrasado</th><th>Último Login</th><th>Última Abertura</th><th>Tempo Ocioso</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tecnicos %}
        <tr {% if t.atraso_min > 29 %}class="alert-row"{% endif %}>
          <td>
            <a href="#" data-bs-toggle="modal" data-bs-target="#modalTecnico"
               data-nome="{{ t.nome }}" data-uid="{{ t.uid }}" data-area="{{ t.area }}"
               data-total="{{ t.total }}" data-concluido="{{ t.concluido }}"
               data-no-tempo="{{ t.no_tempo }}" data-no-limite="{{ t.no_limite }}"
               data-atrasado="{{ t.atrasado }}" data-lastlogin="{{ t.lastlogin }}"
               data-lastopening="{{ t.lastopening }}" data-ocioso="{{ t.atraso_fmt }}"
               data-phone="{{ t.phone }}">
              <i class="fa-regular fa-eye {% if t.atraso_min > 29 %}icon-alert{% endif %}"></i>
            </a>
          </td>
          <td>{{ t.nome }}</td><td>{{ t.uid }}</td><td>{{ t.area }}</td>
          <td>{{ t.total }}</td><td>{{ t.concluido }}</td><td>{{ t.no_tempo }}</td>
          <td>{{ t.no_limite }}</td><td>{{ t.atrasado }}</td>
          <td>{{ t.lastlogin }}</td><td>{{ t.lastopening }}</td><td>{{ t.atraso_fmt }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="12">Nenhum técnico encontrado</td></tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
    
  </div>
</div>

<!-- TABELA DE ORDENS FILTRADAS -->
<div id="tabela-ordens" {% if not filtro_ativo or ver_rota_uid %}style="display:none"{% endif %} > <h4>Ordens Atendidas</h4>
  <div class="table-responsive">
    
    <table class="styled-table dark">
      
      <thead>
        <tr>
          <th>Ação</th><th>OS</th><th>Técnico</th><th>UID</th>
          <th>Horário</th><th>Tempo Restante</th><th>Status</th>
          <th>Tag</th><th>ocorrencia</th><th>Flag</th><th>OBS</th>
        </tr>
      </thead>
      <tbody>
        {% for o in ordens %}
        <tr class="status-{{ o.status_janela|default:'' }} flag-{{ o.flag|default:'' }}">
          <td>
          <a href="#" data-bs-toggle="modal" data-bs-target="#modalOrdem"
          data-nome="{{ o.nome_tecnico|default:'' }}" data-os="{{ o.os |default:""  }}"   data-uid="{{ o.uid |default:"" }}"
            data-horario="{{ o.alteracao_hf |default:"" }}" data-tempo="{{ o.tempo_restante|default:""  }}" data-longitude="{{ o.longitude|default:""  }}" data-latitude="{{o.latitude|default:""}}" data-imageurl="{{o.imageurl|default:'-'}}"
            data-endereco="{{ o.endereco |default:"" }}" data-status="{{ o.status_janela |default:"" }}"
            data-tag="{{ o.tag |default:"" }}" data-flag="{{ o.flag|default:""  }}" data-mensagem="{{ o.mensagem|default:""  }}">
            <i class="fa-regular fa-eye"></i>
          </a>
        </td>

          <td>{{ o.os|default:""  }}</td><td>{{ o.nome_tecnico |default:"" }}</td><td>{{ o.uid|default:""  }}</td>
          <td>{{ o.alteracao_hf|default:"" }}</td><td>{{ o.tempo_restante |default:"" }}</td>
        <td class="status {{ o.status_janela }}">{{ o.status_janela |default:"" }}</td>
          <td>{{ o.tag |default:"" }}</td><td>{{ o.ocorrencia |default:"" }}</td><td class="flag {{ o.flag }}">{{ o.flag |default:"" }}</td>
          <td class="mensagem {{ o.mensagem }}">{{ o.mensagem|default:""  }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="11">Nenhuma ordem encontrada</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div><div class="pagination">
  {% if skip > 0 %}
    <a href="?skip={{ prev_skip }}&limit={{ limit }}{% if filtro_status %}&status_janela={{ filtro_status }}{% endif %}{% if filtro_flag %}&flag={{ filtro_flag }}{% endif %}{% if filtro_msg %}&mensagem={{ filtro_msg }}{% endif %}{% if filtro_uid %}&uid={{ filtro_uid }}{% endif %}">
      ← Anterior
    </a>
  {% endif %}

  <a href="?skip={{ next_skip }}&limit={{ limit }}{% if filtro_status %}&status_janela={{ filtro_status }}{% endif %}{% if filtro_flag %}&flag={{ filtro_flag }}{% endif %}{% if filtro_msg %}&mensagem={{ filtro_msg }}{% endif %}{% if filtro_uid %}&uid={{ filtro_uid }}{% endif %}">
    Próxima →
  </a>
</div>
</div>

<!-- TABELA DETALHADA POR TÉCNICO (MODAL) -->
<div id="tabela-filtrada"{%if not ver_rota_uid %}style="display:none"{% endif %} >
  <div class="d-flex justify-content-between align-items-center mb-2">
    {% if ordens_os %}
    <h4 style='color:#168dd8;'>
      Ordens Detalhadas - Técnico: {{ ordens_os.0.nome_tecnico |default:"" }} (UID: {{ ordens_os.0.uid }})
    </h4>
  {% else %}
    <h4>Ordens Detalhadas</h4>
  {% endif %}
       <a href="{{ request.path }}" class="btn btn-secondary btn-sm">
      ← Voltar para Técnicos
    </a>
    
  </div>
  <div>

  <div class="table-responsive">
   
    <table class="styled-table dark">
      <thead>
        <tr>
          <th>Ação</th><th>OS</th><th>Horario</th><th>Tempo Restante</th>
          <th>Status</th><th>Tag</th><th>ocorrencia</th><th>Flag</th><th>OBS</th>
        </tr>
      </thead>
      <tbody>
        {% for o in ordens_os %}
        <tr class="ordem-linha" data-uid="{{ o.uid }}">
          <td> <a href="#" data-bs-toggle="modal" data-bs-target="#modalOrdem"
           data-nome="{{ o.nome_tecnico |default:"" }}"  data-os="{{ o.os|default:""  }}" data-uid="{{ o.uid|default:""  }}"
            data-horario="{{ o.alteracao_hf |default:""  }}" data-tempo="{{ o.tempo_restante |default:""  }}" data-longitude="{{ o.longitude|default:""  }}" data-latitude="{{o.latitude|default:""}}" data-imageurl="{{o.imageurl|default:'-'}}"
            data-endereco="{{ o.endereco |default:"" }}" data-status="{{ o.status_janela |default:"" }}"
            data-tag="{{ o.tag|default:""  }}" data-flag="{{ o.flag|default:""  }}" data-mensagem="{{ o.mensagem|default:""  }}">
            <i class="fa-regular fa-eye"></i>
          </a></td>
          <td>{{ o.os }}</td><td>{{o.alteracao_hf |default:""  }}</td>
           <td>{{ o.tempo_restante |default:"" }}</td><td class="status {{ o.status_janela }}">{{ o.status_janela |default:"" }}</td><td>{{ o.tag |default:"" }}</td>
           <td>{{ o.ocorrencia |default:"" }}</td><td class="flag {{ o.flag }}">{{ o.flag |default:""  }}</td>
           <td class="mensagem {{ o.mensagem }}">{{ o.mensagem |default:"" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="9">Nenhuma ordem detalhada encontrada</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
</div>
</div>