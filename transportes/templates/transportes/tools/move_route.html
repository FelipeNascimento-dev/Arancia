{% extends 'global/base.html' %} {% block content %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>

<div class="setcontainer" style="margin-top: 95px">
  <h2>Mover Rotas</h2>

  <!-- IMPORTANTE: enctype adicionado para envio de arquivo -->
  <form method="POST" enctype="multipart/form-data" class="form-grid-2col">
    {% csrf_token %}

    <!-- Box Técnico -->
    <div>
      <label for="nome_tecnico">Técnico</label>
      <select name="nome_tecnico" class="form-control">
        <option value="">Selecione um técnico</option>

        <option value="2">Tirar os da rota</option>
        <option value="0">Mover para lista de cancelamento</option>

        {% for tec in tecnicos %} {% if tec.uid %}
        <option value="{{ tec.uid }}">
          {{ tec.name }} (UID: {{ tec.uid }})
        </option>
        {% endif %} {% endfor %}
      </select>
    </div>

    <!-- Box OS -->
    <div>
      <label for="os_list">Ordem de Serviço(s)</label>
      <textarea
        name="os_list"
        rows="6"
        class="form-control"
        placeholder="Digite uma OS por linha"
      >
{{ request.POST.os_list }}</textarea
      >
    </div>

    <!-- Novo campo: Upload PDF ou Excel --><label
      for="file_upload"
      class="form-label fw-bold mb-0 me-2"
      >Enviar Arquivo (PDF ou Excel)</label
    >
    <div
      style="
        grid-column: 1 / -1;
        margin-top: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      "
    >
      <!-- Botão de upload -->
      <button type="button" id="customUploadBtn" class="btn btn-primary">
        <i class="fa-solid fa-file-arrow-up"></i> Escolher arquivo
      </button>

      <!-- Nome do arquivo -->
      <span id="fileName" class="text-muted ms-2"></span>

      <!-- Input oculto -->
      <input
        type="file"
        id="file_upload"
        name="file_upload"
        accept=".pdf,.xls,.xlsx"
        style="display: none"
      />

      <!-- Botão de mover -->
      <button type="submit" class="submit-button-right ms-auto">
        <i class="fa fa-exchange-alt"></i> Mover
      </button>
    </div>

    <script>
      document
        .getElementById("customUploadBtn")
        .addEventListener("click", () => {
          document.getElementById("file_upload").click();
        });

      document
        .getElementById("file_upload")
        .addEventListener("change", function () {
          const fileName = this.files.length > 0 ? this.files[0].name : "";
          document.getElementById("fileName").textContent = fileName;
        });
    </script>
  </form>
</div>
{% endblock %}
