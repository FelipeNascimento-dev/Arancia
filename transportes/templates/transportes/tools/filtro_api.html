{% extends 'global/base.html' %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<div class="setcontainer" style="margin-top:65px">
  <h2><i class="fa-solid fa-sliders"></i> Configuração de Filtros</h2>

  <form method="post" class="form-grid-2col">
    {% csrf_token %}
    <!-- hidden para saber para onde voltar -->
    <input type="hidden" name="next" value="{{ next_url }}">

    <!-- Cliente -->
    <div>
      <label for="cod_base">Cliente</label>
      <select id="cod_base" name="cod_base" required>
        <option value=""></option>
        <option value="CTBSEQ" {% if cod_base == "CTBSEQ" %}selected{% endif %}>CTBSEQ</option>
        <option value="CTBFED" {% if cod_base == "CTBFED" %}selected{% endif %}>CTBFED</option>
      </select>
    </div>

    <!-- Projeto -->
    <div>
      <label for="projeto">Projeto</label>
      <select id="projeto" name="projeto">
        <option value=""></option>
        {% for p in projetos_disponiveis %}
          <option value="{{ p }}" {% if projeto == p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Profile -->
    <div>
      <label for="profile">Profile  (opcional)</label>
      <select id="profile" name="profile">
        <option value=""></option>
        {% for p in profile_options %}
          <option value="{{ p }}" {% if profile == p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Botão -->
    <div class="form-actions" style="grid-column: 1 / -1;">
      <button type="submit" class="submit-button-right">Aplicar</button>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const projectsByBase = {
    "CTBSEQ": ["CTBPO", "CIELO",  "CLARO"],
    "CTBFED": ["FISERV", "CTB", "C6-BANK", "PICPAY"],
  };

  const codBaseSelect = document.getElementById("cod_base");
  const projetoSelect = document.getElementById("projeto");

  codBaseSelect.addEventListener("change", function () {
    const base = this.value;
    projetoSelect.innerHTML = '<option value=""></option>'; 
    if (projectsByBase[base]) {
      projectsByBase[base].forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.textContent = p;
        projetoSelect.appendChild(opt);
      });
    }
  });
});
</script>

{% endblock %}
