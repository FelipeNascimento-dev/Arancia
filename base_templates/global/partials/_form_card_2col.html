<h2>{{ form.nome_formulario }}</h2>

<form method="POST" action="{{ acao_url }}" class="card-2col">
    {% csrf_token %}

    {{ form.non_field_errors }}

    {% if impar %}
    <div class="card-group card-centralizado">
        {{ primeiro_campo.label_tag }}
        {{ primeiro_campo }}
        {% if primeiro_campo.errors %}
        <div class="card-error">{{ primeiro_campo.errors }}</div>
        {% endif %}
    </div>
    {% endif %}

    <div class="card-grid-2col">
        {% for campo in form %}
        {% if campo.name != primeiro_campo.name %}
        <div class="card-group">
            {{ campo.label_tag }}
            {{ campo }}
            {% if campo.errors %}
            <div class="card-error">{{ campo.errors }}</div>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <div class="form-actions">

        {% if botao_texto == "RECEBER DESINSTALAÇÃO" %}
        <button type="submit" class="submit-button-right" name="enviar_evento" value="1">
            {{ botao_texto }}
        </button>
        {% elif botao_texto == "RECEBER ESTOQUE" %}
        <button type="button" class="submit-button-right" id="abrirModal">
            {{ botao_texto }}
        </button>
        {% elif botao_texto == "RECEBER REVERSA" %}
        <div class="actions-menu">
            <button type="button" class="btn-actions" onclick="toggleActionsMenu()">
                Ações ▾
            </button>
            <div id="actions-dropdown" class="actions-dropdown">
                {% csrf_token %}
                <div class="itens">
                    <button type="submit" class="dropdown-item" name="cancelar_pedido" value="1">
                        CANCELAR PEDIDO
                    </button>
                    <button type="submit" class="dropdown-item" name="troca_custodia" value="1">
                        TROCA DE CUSTODIA
                    </button>
                </div>
            </div>
        </div>
        {% elif botao_texto == "PROXIMA TRACKING" %}
        <button type="submit" class="submit-button-right" name="enviar_evento" value="1">
            {{ botao_texto }}
        </button>
        {% elif mostrar_receber_insucesso %}
        <button type="submit" class="submit-button-right " name="receber_insucesso" value="1">
        {{ botao_texto }}
        </button>
        {% else %}
        <button type="button" class="submit-button-right">
            Definir botão no template _form_card_2col
        </button>
        {% endif %}
        
    </div>
</form>


<!--##### MODAL #####-->

<div id="modalConfirm" class="modal">
    <div class="modal-content">
        <h3>Confirmação</h3>
        <br>
        <p>Tem certeza que deseja inserir no estoque?</p>
        <div class="modal-actions">
            <button id="confirmarSim" class="submit-button-right" data-url="{% url 'logistica:consultar_pedido' %}">
                Sim
            </button>
            <button id="fecharModal" class="submit-button-right">Cancelar</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const abrirModal = document.getElementById("abrirModal");
        const modal = document.getElementById("modalConfirm");
        const fecharModal = document.getElementById("fecharModal");
        const confirmarSim = document.getElementById("confirmarSim");

        if (abrirModal) {
            abrirModal.addEventListener("click", () => {
                modal.style.display = "flex";
            });
        }

        if (fecharModal) {
            fecharModal.addEventListener("click", () => {
                modal.style.display = "none";
            });
        }

        if (confirmarSim) {
            confirmarSim.addEventListener("click", () => {
                const url = confirmarSim.getAttribute("data-url");
                window.location.href = url;
            });
        }

        modal.addEventListener("click", e => {
            if (e.target === modal) {
                modal.style.display = "none";
            }
        });
    });
</script>