{% load static %}

<link rel="stylesheet" href="{% static 'css/transport.css' %}">

<div class="transport-wrapper">

  <!-- HEADER -->
  <div class="transport-header">
    <h2>
      Pedido {{ service_order.order_number }}
      <span class="status-pill">
        {{ service_order.order_state.description }}
      </span>
    </h2>
    <small>
      Tipo: {{ service_order.order_type.description }} |
      Criado por: {{ service_order.created_by }}
    </small>
  </div>

  <!-- GRID PRINCIPAL -->
  <div class="grid-4">

    <!-- CARD GRANDE – PEDIDO + INFO GERAL -->
    <div class="box span-4">
      <h4>Informações do Pedido</h4>

      <div class="inner-grid-4">
        <div><strong>OS:</strong><br>{{ service_order.order_number }}</div>
        <div><strong>Tipo:</strong><br>{{ service_order.order_type.description }}</div>
        <div><strong>Status:</strong><br>{{ service_order.order_state.description }}</div>
        <div><strong>Valor:</strong><br>R$ {{ service_order.price_charged }}</div>
      </div>

      <hr style="margin:8px 0">

      <div class="inner-grid-4">
        <div>
          <strong>Cliente</strong><br>
          {{ client.nome }}<br>
          {{ client.cidade }}/{{ client.estado }}
        </div>

        <div>
          <strong>Origem</strong><br>
          {{ origin.nome }} ({{ origin.cod_iata }})<br>
          {{ origin.cidade }}/{{ origin.estado }}
        </div>

        <div>
          <strong>Destino</strong><br>
          {{ destination.nome }} ({{ destination.cod_iata }})<br>
          {{ destination.cidade }}/{{ destination.estado }}
        </div>

        <div>
          <strong>Email</strong><br>
          {{ destination.email }}
        </div>
      </div>
    </div>

    <!-- CARDS PEQUENOS -->
    <div class="box soft">
      <h4>Resumo Financeiro</h4>
      {% if quote %}
        <p>Valor: R$ {{ quote.estimated_price }}</p>
        <p>Peso: {{ quote.total_weight }} kg</p>
        <p>Volume: {{ quote.total_volume }}</p>
      {% else %}
        <p>Sem cotação</p>
      {% endif %}
    </div>

    <div class="box soft">
      <h4>Prazos</h4>
      {% if quote %}
        <p>{{ quote.estimated_deadline }} dias</p>
      {% else %}
        <p>Não informado</p>
      {% endif %}
    </div>

    <div class="box soft">
      <h4>Transportes</h4>
      <p>{{ travels|length }} viagem(ns)</p>
    </div>

    <div class="box soft">
      <h4>Volumes</h4>
      <p>{{ items|length }} item(ns)</p>
    </div>

    <!-- VOLUMES -->
    <div class="box span-4">
      <h4>Volumes / Itens</h4>

      {% for item in items %}
        <div class="volume-card">

          <div class="volume-header">
            <strong>Volume {{ forloop.counter }}</strong>
            <!-- <div>
              <button class="btn-outline">Ver etiqueta</button>
              <button class="btn-outline">Editar</button>
              <button class="btn-primary">Enviar</button>
            </div> -->
          </div>

          <div class="volume-grid">
            <div><strong>Série:</strong><br>{{ item.serial_number }}</div>
            <div><strong>Modelo:</strong><br>{{ item.product_model }}</div>
            <div><strong>Tipo:</strong><br>{{ item.product_type }}</div>
            <div><strong>Prazo:</strong><br>{{ item.service_deadline|date:"d/m/Y" }}</div>
          </div>

          <div class="timeline">
            {% for ev in item.item_events %}
              <div class="timeline-item">
                <span class="dot"></span>
                {{ ev.description }} — {{ ev.created_by }}
              </div>
            {% endfor %}
          </div>

        </div>
      {% empty %}
        <p class="empty">Nenhum item</p>
      {% endfor %}
    </div>

    <!-- HISTÓRICO GERAL -->
    <div class="box span-4">
      <h4>Histórico Geral</h4>

      <div class="timeline">
        {% for h in historico %}
          <div class="timeline-item">
            <span class="dot"></span>
            {{ h.descricao }} — {{ h.created_by }}
          </div>
        {% empty %}
          <p class="empty">Sem histórico</p>
        {% endfor %}
      </div>
    </div>

  </div>
</div>
