{% load static %}


<div class="transport-module">

    <div class="tm-header">
        <h2>Teste Transportes</h2>
    </div>

    <div class="tm-section">
        <div class="tm-section-header">
            <h3>Cotações de Transporte</h3>
            <button type="button" class="tm-toggle" data-target="cotacao">
                +
            </button>
        </div>

        <div class="tm-section-body" id="section-cotacao">
            <div class="tm-grid">

                <div class="tm-grid-layout">

                    <div class="tm-card card-main-left">
                        <h4>Dados da Cotação</h4>

                        <p><strong>OS:</strong> {{ service_order.order_number }}</p>
                        <p><strong>Tipo:</strong> {{ service_order.order_type.description }}</p>
                        <p><strong>Status:</strong> {{ service_order.order_state.description }}</p>
                        <p><strong>Criado por:</strong> {{ service_order.created_by }}</p>
                    </div>

                    <div class="tm-card card-bottom-left">
                        <h4>Dados Complementares</h4>

                        <p><strong>Cliente:</strong> {{ client.nome }}</p>
                        <p><strong>Origem:</strong> {{ origin.nome }} ({{ origin.cod_iata }})</p>
                        <p><strong>Destino:</strong> {{ destination.nome }} ({{ destination.cod_iata }})</p>
                    </div>

                    <div class="tm-sidebar">

                        <div class="tm-info-card">
                            <div class="tm-info-header">
                                <span>Resumo Financeiro</span>
                                <button type="button" class="tm-info-toggle">+</button>
                            </div>
                            <div class="tm-info-body">
                                {% if quote %}
                                    <p><strong>Valor estimado:</strong> R$ {{ quote.estimated_price }}</p>
                                    <p><strong>Peso total:</strong> {{ quote.total_weight }} kg</p>
                                    <p><strong>Volume:</strong> {{ quote.total_volume }}</p>
                                {% else %}
                                    <p>Sem cotação disponível</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="tm-info-card">
                            <div class="tm-info-header">
                                <span>Prazos</span>
                                <button type="button" class="tm-info-toggle">+</button>
                            </div>
                            <div class="tm-info-body">
                                {% if quote %}
                                    <p><strong>Prazo estimado:</strong> {{ quote.estimated_deadline }} dias</p>
                                {% else %}
                                    <p>Prazo não informado</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="tm-info-card">
                            <div class="tm-info-header">
                                <span>Riscos / Observações</span>
                                <button type="button" class="tm-info-toggle">+</button>
                            </div>
                            <div class="tm-info-body">...</div>
                        </div>

                        <div class="tm-card">
                            <h4>Histórico</h4>

                            {% for h in historico %}
                                <p>
                                    • <strong>[{{ h.tipo }}]</strong>
                                    {{ h.descricao }}
                                    ({{ h.created_by }})
                                </p>
                            {% empty %}
                                <p>Sem histórico</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tm-section">
        <div class="tm-section-header">
            <h3>Informações da Carga</h3>
            <button type="button" class="tm-toggle" data-target="carga">+</button>
        </div>

        <div class="tm-section-body" id="section-carga">
            <div class="tm-grid">

                <div class="tm-card">
                    <h4>Dados da Carga</h4>
                    {{ carga_form.as_p }}
                </div>

                <div class="tm-card info">
                    <h4>Detalhes</h4>
                    <p>Peso total: <strong>{{ carga.peso_total }}</strong></p>
                    <p>Volumes: <strong>{{ carga.volumes }}</strong></p>
                    <p>Tipo: <strong>{{ carga.tipo }}</strong></p>
                </div>

            </div>
        </div>
    </div>

    <div class="tm-section">
        <div class="tm-section-header">
            <h3>Transportadoras</h3>
            <button type="button" class="tm-toggle" data-target="transportadora">+</button>
        </div>

        <div class="tm-section-body" id="section-transportadora">
            <div class="tm-grid">

                {% for transportadora in transportadoras %}
                <div class="tm-card clickable">
                    <h4>{{ transportadora.nome }}</h4>
                    <p>Prazo médio: {{ transportadora.prazo }} dias</p>
                    <p>Rating: ⭐ {{ transportadora.rating }}</p>
                </div>
                {% empty %}
                <p class="tm-empty">Nenhuma transportadora disponível</p>
                {% endfor %}

            </div>
        </div>
    </div>

    <div class="tm-section">
        <div class="tm-section-header">
            <h3>Status & Histórico</h3>
            <button type="button" class="tm-toggle" data-target="status">+</button>
        </div>

        <div class="tm-section-body" id="section-status">
            <div class="tm-grid">

                {% for event in historico %}
                <div class="tm-card timeline">
                    <span class="tm-date">{{ event.data }}</span>
                    <p>{{ event.descricao }}</p>
                </div>
                {% empty %}
                <p class="tm-empty">Sem histórico disponível</p>
                {% endfor %}

            </div>
        </div>
    </div>

</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".tm-toggle").forEach(btn => {
            btn.addEventListener("click", () => {
                const target = btn.dataset.target;
                const section = document.getElementById(`section-${target}`);

                section.classList.toggle("hidden");
                btn.textContent = section.classList.contains("hidden") ? "+" : "x";
            });
        });
    });

</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".tm-info-header").forEach(header => {
            header.addEventListener("click", () => {
                const card = header.closest(".tm-info-card");
                card.classList.toggle("active");
            });
        });
    });
</script>